# üöÄ RestoAnalytic

–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–Ω–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞.

## üì• –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ó–∞–ø—É—Å–∫

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Python 3.9+.

```bash
# –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python3 -m venv venv
source venv/bin/activate  # Mac/Linux
# venv\Scripts\activate   # Windows

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.streamlit/secrets.toml` (–µ—Å–ª–∏ –Ω–µ —Å–æ–∑–¥–∞–Ω):

```toml
YANDEX_TOKEN = "–≤–∞—à_—Ç–æ–∫–µ–Ω"
# –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∫–ª—é—á–µ–π:
TG_BOT_TOKEN = "–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞"
TG_CHAT_ID = "–≤–∞—à_chat_id"
# –∏–ª–∏:
TELEGRAM_TOKEN = "–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞"
TELEGRAM_CHAT_ID = "–≤–∞—à_chat_id"
```

### 3. –ó–∞–ø—É—Å–∫ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
streamlit run app.py
```

## üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∏ (CI)
–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫ –∫–æ–¥–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```bash
python -m ruff check .
python -m pytest tests/
```
–í –ø—Ä–æ–µ–∫—Ç–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω CI —á–µ—Ä–µ–∑ GitHub Actions (`.github/workflows/ci.yml`), –∫–æ—Ç–æ—Ä—ã–π –≥–æ–Ω—è–µ—Ç —Ç–µ—Å—Ç—ã –∏ –ª–∏–Ω—Ç–µ—Ä –Ω–∞ –≤–µ—Ä—Å–∏—è—Ö Python 3.9 –∏ 3.11 –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø—É—à–µ.

## üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –î–∞–Ω–Ω—ã—Ö
–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:

## ü§ñ Telegram –ë–æ—Ç
–î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ (–º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —á–µ—Ä–µ–∑ cron):
```bash
python daily_report.py
```

## üõ† –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞ (–°–ª–æ–∏ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É:
- `views/` - –ú–æ–¥—É–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (`reports_view`, `admin_view`, `login_view`). –û—Ç–≤–µ—á–∞—é—Ç —Ç–æ–ª—å–∫–æ –∑–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ.
- `use_cases/` - –°–ª–æ–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ (Application Layer). –°–æ–¥–µ—Ä–∂–∏—Ç —Ñ–∞–π–ª—ã –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –ø–æ—Ç–æ–∫–æ–≤ (–∫ –ø—Ä–∏–º–µ—Ä—É `auth_flow`, `bootstrap`, `report_flow`), –Ω–µ –∑–∞–≤–∏—Å—è—â–∏–µ –æ—Ç –≤–µ—Ä—Å—Ç–∫–∏.
- `services/` - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:
    - `data_loader.py` - –ó–∞–≥—Ä—É–∑–∫–∞, –ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥ –∏ –ø–∞—Ä—Å–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤.
    - `analytics_service.py` - –†–∞—Å—á–µ—Ç KPI –∏ –±–∏–∑–Ω–µ—Å-–∏–Ω—Å–∞–π—Ç–æ–≤.
    - `category_service.py` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –∏ –º–∞–ø–ø–∏–Ω–≥–æ–º.
- `infrastructure/` - –ê–¥–∞–ø—Ç–µ—Ä—ã –∫ –≤–Ω–µ—à–Ω–∏–º —Å–∏—Å—Ç–µ–º–∞–º (–±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, —Ö—Ä–∞–Ω–µ–Ω–∏—è, API –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–æ–≤), –∫ –ø—Ä–∏–º–µ—Ä—É `yandex_disk_storage.py`.
- `utils/` - –£—Ç–∏–ª–∏—Ç—ã –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–≤ —Ç–æ–º —á–∏—Å–ª–µ `session_manager.py`).

–ö–æ—Ä–Ω–µ–≤—ã–µ —Ñ–∞–π–ª—ã:
- `app.py` - –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Streamlit Dashboard) - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞.
- `auth.py` - –†–∞–±–æ—Ç–∞ —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –∏ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
- `config/` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (`keywords.json`).
- `sync_data.py` - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –æ–±–ª–∞–∫–æ–º.
- `daily_report.py` - –£—Ç–∏–ª–∏—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç—á–µ—Ç–æ–≤ –≤ Telegram.

### üìù –ö–æ–Ω—Ç—Ä–∞–∫—Ç –°–æ—Å—Ç–æ—è–Ω–∏—è (Session State)

–í—Å–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å–æ `st.session_state` —Å—Ç—Ä–æ–≥–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `utils/session_manager.py`. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –∫–ª—é—á–∏ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:
- `df_full`: –¢–µ–∫—É—â–∏–π –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π DataFrame.
- `view_cache`: –ö—ç—à –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π.
- `yandex_path`: –ü—É—Ç—å –∫ –ø–∞–ø–∫–µ –æ—Ç—á–µ—Ç–æ–≤ –≤ –æ–±–ª–∞–∫–µ.
- `auth_user`: –û–±—ä–µ–∫—Ç —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—ç–∫–∑–µ–º–ø–ª—è—Ä DTO `use_cases.session_models.UserSession`).
- `session_diag_seen`: –§–ª–∞–≥ (bool) –¥–ª—è –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞ –æ —Å–±—Ä–æ—à–µ–Ω–Ω–æ–π cookie.

## üêû –û—Ç–ª–∞–¥–∫–∞
–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —Å—Ö–æ–¥—è—Ç—Å—è –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é (—Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç 1–°):
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.
2. –í –±–æ–∫–æ–≤–æ–º –º–µ–Ω—é —Ä–∞—Å–∫—Ä–æ–π—Ç–µ **"üêû Debug: –û—Ç–±—Ä–æ—à–µ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏"**.
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ø–∏—Å–æ–∫ –∏—Å–∫–ª—é—á–µ–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π.

---
–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è –ë–∞—Ä –ú–ï–°–¢–û.
